<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 多设备项目代码同步 | Wenjie Xu </title> <meta name="author" content="Wenjie Xu"> <meta name="description" content="基于 VHDX 和同步盘的多设备的代码同步方案"> <meta name="keywords" content="Wenjie Xu, Wayne Xu, 徐文杰，UCAS, University of Chinese Academy of Sciences, Institutes of Science and Development, Chinese Academy of Sciences"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Wenjie Xu"
        },
        "url": "https://waynehsucn.github.io//blog/2024/%E5%9F%BA%E4%BA%8EVHDX%E7%9A%84%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5/",
        "@type": "BlogPosting",
        "description": "基于 VHDX 和同步盘的多设备的代码同步方案",
        "headline": "多设备项目代码同步",
        
        "name": "Wenjie Xu",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.ico?ae5453b25a07602f7c3e5f03b1034096"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://waynehsucn.github.io//blog/2024/%E5%9F%BA%E4%BA%8EVHDX%E7%9A%84%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Wenjie Xu </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">多设备项目代码同步</h1> <p class="post-meta"> Created in November 05, 2024 , last updated in November 30, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/vhdx"> <i class="fa-solid fa-hashtag fa-sm"></i> VHDX</a>   <a href="/blog/tag/codesync"> <i class="fa-solid fa-hashtag fa-sm"></i> CodeSync</a>   ·   <a href="/blog/category/productivity"> <i class="fa-solid fa-tag fa-sm"></i> Productivity</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>先讲需求。我有 4 台电脑，按使用频率排序分别是台式电脑、联想笔记本、微软 Surface Pro7 和迷你主机。台式机占据了 95% 的使用时间，用于日常办公和开发；迷你主机用于长时间运行且低性能要求的任务；笔记本和 Surface 则用于外出携带。为了实现跨设备的无缝工作流，需要高效同步代码和文件。</p> <p>目前，OneDrive 已完全满足除代码外的文件实时同步需求，特别是在 Windows 11 环境下。但代码同步始终存在问题。</p> <hr> <h2 id="onedrive-同步代码的局限">OneDrive 同步代码的局限</h2> <p>我的代码分为两类备份：</p> <ul> <li> <strong>Code</strong>文件夹：存储零散的原型代码，OneDrive 同步表现良好。</li> <li> <strong>CodeSpace</strong>文件夹：存储系统性项目代码，包括科研原型、小型项目和开源代码。这类代码同步存在以下问题： <ul> <li> <strong>同步慢</strong>。JavaScript/TypeScript 的<code class="language-plaintext highlighter-rouge">node_modules</code> 文件夹往往巨大且文件层级深，这会让云盘同步机制捉襟见肘。每个小文件都需要单独上传、处理和版本控制。</li> <li> <strong>冲突多</strong>。当在多设备间频繁切换修改时，文件锁和冲突的概率大幅提升。OneDrive 会生成文件名 - 冲突副本，而我还需要花时间手动对比和解决。</li> <li> <strong>完整性风险</strong>。在频繁修改的开发场景下，云盘可能因为未完成同步或网络中断导致文件损坏。直接同步源码文件容易出现版本冲突问题，特别是当多个设备同时访问和编辑代码时。</li> <li> <strong>环境依赖问题</strong>。将代码直接放在云盘，只解决了代码的「搬运」问题，但没有解决运行环境的迁移。切换设备后，仍需手动重建环境、安装依赖库等。</li> </ul> </li> </ul> <p>同步网盘，比如坚果云官方建议，不要使用坚果云同步代码，用 git。但 git 是版本控制工具，又不是同步工具，代码可以托管平台，但快速迭代中频繁 push/pull 既麻烦又低效。同时，项目临时文件无法轻松清理，增加版本库体积。这些所有问题在我快速迭代代码或者开发大型项目时尤其明显。因此，现有方案无法满足 <strong>CodeSpace</strong> 文件夹的复杂需求，亟需新的同步方案。</p> <hr> <h2 id="选择-vhdx--云盘同步动机">选择 VHDX + 云盘同步动机</h2> <p>VHDX 是一种虚拟硬盘文件，可以把它看作一个独立的硬盘设备。把项目的所有代码、依赖环境和一些开发工具（比如常用的脚本和测试数据）都存放在 VHDX 文件里。这样，所有内容都集中在一个文件中，从而实现以下效果：</p> <ul> <li>避免同步大量小文件的低效问题，只需同步一个大文件。</li> <li>所有代码和相关依赖都存储在 VHDX 中，无需担心遗漏关键文件。</li> <li>VHDX 的整体备份非常方便，可以直接复制到外部硬盘或另一个云盘服务。</li> <li>VHDX 本质上是虚拟硬盘，可以用作块存储的抽象层，持差分磁盘文件，这使得它可以结合块级同步技术，例如存储级快照和增量同步</li> <li>VHDX 可以存放任何特定于项目的目录、文件和包缓存。在你切换设备时，只需挂载同步好的 VHDX 文件，设置相同的盘符和缓存路径（如 npm、pip），即可获得完整的项目和环境，无需重新安装依赖。</li> <li>VHDX 支持动态扩展，随着数据被写入磁盘，虚拟硬盘文件会增长到其最大大小。</li> <li>VHDX 支持最大 64 TB，并针对因停电等问题导致的意外 IO 故障提供更具弹性的保护。</li> <li>如果项目发生严重问题，可以通过 OneDrive 的历史版本功能恢复 VHDX 文件的任意版本。</li> </ul> <p>比如 VHDX 驱动器的目录结构可以设计成：</p> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">X</span><span class="o">:</span>\
<span class="nf">├── PythonProjects</span>\
<span class="nf">│   ├── ProjectA</span>\
<span class="nf">│   ├── ProjectB</span>\
<span class="nf">│   └── VirtualEnvs</span>\
<span class="nf">├── JuliaProjects</span>\
<span class="nf">│   ├── ResearchProject</span>\
<span class="nf">│   └── SharedPackages</span>\
<span class="nf">├── JavaScriptProjects</span>\
<span class="nf">│   ├── FrontendApp</span>\
<span class="nf">│   ├── NodeModules</span>\
<span class="nf">│   └── Utils</span>\
<span class="nf">├── Tools</span>\
<span class="nf">│   ├── Scripts</span>\
<span class="nf">│   └── Templates</span>\
<span class="nf">└── packages</span>\
<span class="nf">    ├── nodejs</span>\
<span class="nf">    ├── npm</span>\
<span class="nf">    └── pip</span>\
</code></pre></div></div> <h2 id="实际使用">实际使用</h2> <p>Windows 11 新增的开发人员驱动器是一种新形式的存储卷，可用于提高关键开发人员工作负荷的性能。开发人员驱动器在 ReFS 技术基础上构建，采用有针对性的文件系统优化，并且可以更好地控制存储卷设置和安全性，包括信任指定、防病毒配置和对附加筛选器的管理控制。</p> <p>Windows 设置并导航到系统&gt;存储&gt;高级存储设置&gt;磁盘和卷。可以选择创建开发人员驱动器。系统会提供三个选项：</p> <ul> <li> <strong>创建新的 VHD</strong> - 在新的虚拟硬盘上生成卷</li> <li> <strong>调整现有卷的大小</strong> - 创建新的未分配空间以进行构建</li> <li> <strong>磁盘上的未分配空间</strong> - 使用现有磁盘上的未分配空间。仅当之前在存储中设置了未分配的空间时，才会显示此选项。</li> </ul> <p>因此，在 Windows 11 中，可以方便的利用开发人员驱动器创建 VHDX。</p> <p>虽然由于管理虚拟磁盘层的开销，将开发人员驱动器存储在虚拟硬盘 (VHD) 中可能会稍微降低性能。权衡的是，VHD 可以选择格式为 VHDX，为动态调整大小（如果需要高效管理磁盘空间）、移动或备份数据提供了更大的灵活性。VHD 也高度可移植，允许将 VHD 文件传输到其他计算机或备份位置。具体创建 VHDX 的过程不再描述，<a href="https://learn.microsoft.com/zh-cn/windows/dev-drive/" rel="external nofollow noopener" target="_blank">Windows Learn</a>的讲解简洁明了。</p> <h2 id="很烦">很烦</h2> <p>项目一多 VHDX 占用空间就会很大，而 OneDrive 每次同步 VHDX 时都是全量的，没法增量同步。</p> <p>考虑到出门基本不会高强度迭代代码，就仅当弄了个新方案来备份项目代码。</p> <blockquote> <p>2024.12.15 我当时就是个傻逼，这玩意对我没什么用处，还浪费大半天时间了解，我是在哪儿看到 VHDX 可以增量备份的，nmd</p> </blockquote> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">工作环境系统实用配置记录</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Linux%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">Linux 实用配置记录</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/%E9%83%A8%E7%BD%B2%E7%94%A8%E4%BA%8E%E5%AD%A6%E6%9C%AF%E7%A0%94%E7%A9%B6%E7%9A%84Linux%E6%9C%8D%E5%8A%A1%E5%99%A8/">部署用于学术研究的 Linux 服务器</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/%E5%A4%9A%E8%BD%A8%E7%AE%A1%E7%90%86Python%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/">Conda-Pyenv-Poetry 多轨管理 Python 环境</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Windows%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">Windows 实用配置记录</a> </li> </div> </div> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Wenjie Xu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: January 03, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script src="/assets/js/tooltips-setup.js?53023e960fbc64cccb90d32e9363de2b"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-H0H008S793"></script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>